<?phpclass Users extends CI_Controller {    function __construct()    {        parent::__construct();        $this->load->helper(array('language', 'url', 'form', 'ssl', 'pool', 'date'));        $this->load->library(array('authentication'));        $this->load->model(array('account_model'));        $this->load->model(array('account_details_model'));        $this->load->model(array('account_twitter_model'));        $this->load->model(array('account_facebook_model'));		$this->load->model(array('account_openid_model'));        $this->db->select('language');        $query = $this->db->get_where('account_details', array('account_id' => $this->session->userdata('account_id')));        $lang = $query->row_array();        if (isset($lang['language']))  {$this->config->set_item('language',$lang['language']);}        $this->lang->load(array('general', 'users'));    }        function index()    {    }        function viewusers()    {                if ($this->authentication->is_signed_in() && is_admin())        {                   $sql_query = "SELECT account.*, account_details.*, SUM(`prediction`.`pred_points_total`) AS points_total                          FROM `account`                          JOIN `account_details`                          ON `account_details`.`account_id` = `account`.`id`						  JOIN `prediction`						  ON `prediction`.`account_id` = `account`.`id`						  GROUP BY `prediction`.`account_id`						  ORDER BY points_total DESC";            $query = $this->db->query($sql_query);            $users = $query->result_array();			$data = array(			'users'             => $users,			'account'           => $this->account_model->get_by_id($this->session->userdata('account_id')),			'account_details'   => $this->account_details_model->get_by_account_id($this->session->userdata('account_id'))			);            if ($this->config->item('public_social_links'))            {                foreach($users as $user)                {                                        // Get Facebook accounts                    if ($facebook_accounts = $this->account_facebook_model->get_by_account_id($user['id']))                    {                        //echo "<pre>"; print_r($facebook_account); echo "</pre>";                        foreach($facebook_accounts as $facebook_account)                        {                            $users_social[$user['id']]['facebook_id']	=	$facebook_account->facebook_id;                            $users_social[$user['id']]['id']			=   $user['id'];                        }                    }                                        // // Get Twitter accounts                    if ($twitter_accounts[$user['id']] = $this->account_twitter_model->get_by_account_id($user['id']))                    {                        //$this->load->config('twitter');                        $this->load->helper('twitter');                        foreach ($twitter_accounts[$user['id']] as $index => $twitter_link)                          {                            $users_social[$user['id']]['twitter_id']	=	$twitter_link->twitter_id;                            $users_social[$user['id']]['id']			=   $user['id'];                         }                     }                }            }            else            {                $twitter_accounts = 0;                $users_social = 0;            }    			//echo "<pre>"; print_r($users_social); echo "</pre>";			$data['users_social'] = $users_social;			$data['twitter_accounts'] = $twitter_accounts;            $data['content_main'] = "show_all_users";            $data['title'] = lang('show_all_users');                        $this->load->view('template/template', $data);                    }        else        {            redirect('account/sign_in/?continue='.site_url('users/viewusers'));        }    }}